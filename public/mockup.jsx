// window.title = "Fall Vacation: October 21-24"

// window.choices = [
// 	{ 
// 		location: "Big Sur, CA",
// 		price: "$240",
// 		image: "https://a2.muscache.com/im/pictures/3c8d3246-f27c-4044-9a2e-e0a6c78d5296.jpg?aki_policy=large",
// 		description: "Gorgeous Ocen Front Property", 
// 		likes: 2, 
// 		link: "",
// 		booked: false,
// 		images: [
// 			"https://a2.muscache.com/im/pictures/69358559/eecdacaa_original.jpg?aki_policy=large",
// 			"https://a2.muscache.com/im/pictures/69358098/e82386b8_original.jpg?aki_policy=large",
// 			"https://a2.muscache.com/im/pictures/69358624/6a91c232_original.jpg?aki_policy=large",
// 			"https://a0.muscache.com/im/pictures/69358840/7047fd2e_original.jpg?aki_policy=large",
// 			"https://a1.muscache.com/im/pictures/69358675/b64d97da_original.jpg?aki_policy=large",
// 			"https://a1.muscache.com/im/pictures/69358901/7df3b111_original.jpg?aki_policy=large",
// 			"https://a0.muscache.com/im/pictures/69358957/b3b72c44_original.jpg?aki_policy=large",
// 			"https://a1.muscache.com/im/pictures/69359019/7f376f3e_original.jpg?aki_policy=large"
//     	]
// 	},
// 	{
// 		location: "Big Sur, CA",
// 		price: "$355",
// 		image: "https://a2.muscache.com/im/pictures/43006829/fbb07cff_original.jpg?aki_policy=large",
// 		description: "4 Bedroom Cottage in the Woods",
// 		likes: 5,
// 		link: "",
// 		booked: false,
// 		images: [
// 			"https://a2.muscache.com/im/pictures/69358559/eecdacaa_original.jpg?aki_policy=large",
// 			"https://a2.muscache.com/im/pictures/69358098/e82386b8_original.jpg?aki_policy=large",
// 			"https://a2.muscache.com/im/pictures/69358624/6a91c232_original.jpg?aki_policy=large",
// 			"https://a0.muscache.com/im/pictures/69358840/7047fd2e_original.jpg?aki_policy=large",
// 			"https://a1.muscache.com/im/pictures/69358675/b64d97da_original.jpg?aki_policy=large",
// 			"https://a1.muscache.com/im/pictures/69358901/7df3b111_original.jpg?aki_policy=large",
// 			"https://a0.muscache.com/im/pictures/69358957/b3b72c44_original.jpg?aki_policy=large",
// 			"https://a1.muscache.com/im/pictures/69359019/7f376f3e_original.jpg?aki_policy=large"
//     	]
// 	},
// 	{
// 		location: "Monterey, CA",
// 		price: "$534",
// 		image: "https://a0.muscache.com/im/pictures/36575928/b6ec565d_original.jpg?aki_policy=xx_large",
// 		description: "Lovely Home with Hot Tub",
// 		likes: 3,
// 		link: "",
// 		booked: false,
// 		images: [
// 			"https://a2.muscache.com/im/pictures/69358559/eecdacaa_original.jpg?aki_policy=large",
// 			"https://a2.muscache.com/im/pictures/69358098/e82386b8_original.jpg?aki_policy=large",
// 			"https://a2.muscache.com/im/pictures/69358624/6a91c232_original.jpg?aki_policy=large",
// 			"https://a0.muscache.com/im/pictures/69358840/7047fd2e_original.jpg?aki_policy=large",
// 			"https://a1.muscache.com/im/pictures/69358675/b64d97da_original.jpg?aki_policy=large",
// 			"https://a1.muscache.com/im/pictures/69358901/7df3b111_original.jpg?aki_policy=large",
// 			"https://a0.muscache.com/im/pictures/69358957/b3b72c44_original.jpg?aki_policy=large",
// 			"https://a1.muscache.com/im/pictures/69359019/7f376f3e_original.jpg?aki_policy=large"
//     	]
// 	}
// ];

// window.attendees = [
// 	{
// 		name: "Charlene",
// 		status: "paid",
// 		notes: "Room for 2 more in my car"
// 	},
// 	{
// 		name: "Kiki",
// 		status: "unpaid",
// 		notes: "Leaving Saturday"
// 	}
// ];

// window.packing = [
// 	{
// 		thingsToBring: "Dinner Saturday",
// 		whosBringingIt: "Gabe",
// 		notes: "Carnitas!"
// 	},
// 	{
// 		thingsToBring: "Settler's of Catan",
// 		whosBringingIt: "Myshel",
// 		notes: "Game night! Woooooo!"
// 	},
// 	{
// 		thingsToBring: "Catnip",
// 		whosBringingIt: "Charlene",
// 		notes: "Meow"
// 	} 
// ];

// window.details = [
// 	{
// 	text: "Muffin apple pie bear claw muffin croissant sweet donut pie. Cotton candy soufflé caramels icing cake puddingdonut. Halvah biscuit toffee pudding tiramisu. Icing cookie liquorice macaroon gummies candy caramels sugar plum croissant. Danish gummies caramels danish topping candy jelly-o gummi bears. Lemon drops cake candy cake. Caramels gingerbread topping. Candy tiramisu dessert sesame snaps. Sugar plum chupa chups powder donut caramels. Muffin candy icing jelly beans. Powder fruitcake cake carrot cake marshmallow lollipop cake tiramisu. Tootsie roll cake apple pie.\n\nGummies jelly-o cheesecake. Muffin dragée cake croissant dessert wafer cheesecake caramels carrot cake. Marzipan gummi bears liquorice carrot cake marshmallow apple pie chupa chups gummies. Wafer cookie jelly tiramisu wafer cake jelly beans cookie. Brownie macaroon bear claw. Apple pie oat cake cookie biscuit croissant jelly beans lollipop. Candy icing sugar plum cupcake halvah fruitcake. Sesame snaps cake icing sweet gummies. Croissant tart bear claw. Sesame snaps cupcake croissant gummi bears gummies apple pie. Oat cake toffee cake halvah gingerbread muffin. Lemon drops danish toffee chupa chups sesame snaps carrot cake chocolate cake oat cake cupcake. Marzipan jelly beans candy candy canes.\n\nSesame snaps brownie sweet cheesecake topping. Bear claw cookie jelly beans jelly-o bonbon liquorice caramels. Bear claw muffin bonbon toffee chocolate jelly chupa chups brownie marzipan. Pastry oat cake dragée powder marshmallow lollipop. Marzipan jelly beans macaroon. Cookie tootsie roll dragée dessert dessert apple pie danish cupcake. Bonbon macaroon sweet candy canes gingerbread liquorice marshmallow bonbon marzipan. Dragée gingerbread jelly lemon drops jelly cake toffee. Gummi bears cake tiramisu brownie. Chocolate halvah pie caramels carrot cake. Candy chocolate bar lemon drops. Bonbon powder brownie. Oat cake oat cake cheesecake dessert cake.\n\nDragée chupa chups dessert gummi bears pudding carrot cake oat cake. Pie sugar plum lollipop lemon drops macaroon. Pastry oat cake caramels halvah. Topping jelly beans toffee caramels jujubes danish wafer. Candy toffee candy oat cake gummies toffee sugar plum. Toffee powder sugar plum macaroon chupa chups brownie cotton candy pudding sweet roll. Biscuit carrot cake bear claw sweet sweet roll biscuit liquorice. Carrot cake dessert chocolate cake oat cake. Topping chocolate tart ice cream powder oat cake. Tart halvah toffee tootsie roll carrot cake cookie oat cake cake. Tart macaroon caramels brownie tootsie roll. Fruitcake tiramisu ice cream. Chocolate soufflé sugar plum gummies gingerbread. Jelly beans liquorice caramels fruitcake ice cream fruitcake sugar plum apple pie."
// 	}
// ];


var TitleSection = React.createClass({
	getInitialState: function () {
		return {
			isEditing: false
		}
	},
	render: function () {
		if (this.state.isEditing === true || title === "") {
			var titleDiv = 
				<div className="title-section">
					<h1><input type="text" ref="titleInput" placeholder="Add title and dates" onKeyDown={this.enterSubmitTitle}></input></h1>
				</div>
		} else {
			titleDiv = 
				<div className="title-section">
					<h1 onClick={this.clickToEdit}>{title}</h1>
				</div>
		}
		return (
			titleDiv
		);
	},
	clickToEdit: function () {
		this.setState({isEditing: true});
	},
	addTitle: function () {
		var titleInput = this.refs.titleInput;
		var titleText = titleInput.value;
		title = titleText;
		$.post(window.location.pathname + '/title', {title: titleText})
		renderApp();
	},
	enterSubmitTitle: function (event) {
		if (event.keyCode === 13) {
			this.setState({isEditing:false})
			this.addTitle();
		}
	}
})

var VacationChoices = React.createClass({
	getInitialState: function () {
		return {
			isEditing: false
		}
	},
	render: function () {
		var isEditing = this.state.isEditing;
		var locationElements = [];
		for (var i = 0; i < choices.length; i++) {
			locationElements.push(
				<VacationChoice index={i} key={i} isEditing={isEditing}/>
			);
		}

		if (isEditing === true) {
			var topEditButton = null;
		} else {
			var topEditButton = <button onClick={this.editModeOn}>Edit</button>;
		}
		if (isEditing === false) {
			var bottomEditButton = null;
		} else {
			bottomEditButton = <button onClick={this.editModeOff}>Done Editing</button>
		}

 		return (
 			<div>
	 			<div>
	 				<h2>Vote on a Place to Stay: {topEditButton}</h2>
	 			</div>
				<div id="locations">
					{locationElements}	
				</div>
				<div>
					{bottomEditButton}
				</div>
			</div>
		);
	},
	editModeOn: function () {
		this.setState({isEditing: true})
	},
	editModeOff: function () {
		this.setState({isEditing: false}) 
	}
})

var VacationChoice = React.createClass({
	render: function () {
		var i = this.props.index;
		var isEditing = this.props.isEditing;
		if (isEditing === true) {
			var view = 
				<div className="vacation-choice" key={i}>
					<h3>{choices[i].location} - {choices[i].price} Per Night</h3>
					<a href={choices[i].link}><div className="choice-img"><img src={choices[i].image}/></div></a>
					<h3>{choices[i].description}</h3>
					<VoteSection index={i}/><button onClick={this.toggleBooked}>Booked It!</button><br/>
					<input type="text" ref="linkInput" onKeyDown={this.enterSubmit} placeholder="Paste AirBnb Url"></input>
				</div>
		} else {
			view = 
				<div className="vacation-choice" key={i}>
					<h3>{choices[i].location} - {choices[i].price} Per Night</h3>
					<a href={choices[i].link}><div className="choice-img"><img src={choices[i].image}/></div></a>
					<h3>{choices[i].description}</h3>
					<VoteSection index={i}/>
				</div>
		}
		return (
			view
		)
	},
	addLink: function () {
		var i = this.props.index;
		var linkInput = this.refs.linkInput;
		var linkUrl = linkInput.value;
		$.getJSON("airbnbInfo?url=" + linkUrl, function (data) {
			choices[i].location = data.location;
			choices[i].price = data.price;
			choices[i].image = data.image;
			choices[i].description = data.description;
  			choices[i].likes = 0;
  			choices[i].link = linkUrl;
  			choices[i].booked = data.booked;
  			choices[i].images = data.images;
  			$.post('/choices/' + choices[i].id, {
  				location: choices[i].location,
  				price: choices[i].price,
  				image: choices[i].image,
  				description: choices[i].description,
  				likes: choices[i].likes,
  				link: choices[i].link,
  				booked: choices[i].booked,
  				images: choices[i].images
  			})
  			renderApp();
		});
		linkInput.value = "";
	}, 
	enterSubmit: function (event) {
		if (event.keyCode === 13) {
			this.addLink();
		}
	},
	toggleBooked: function () {
		var i = this.props.index;
		choices[i].booked = true;
		$.post('/choices/' + choices[i].id, {
  				booked: choices[i].booked})
		renderApp();
	}
})

var Booked = React.createClass({
	render: function () {
		var i = this.props.index;
		var imageElements = [];
		var allImages = choices[i].images
		var imagesArr = allImages.split('\n')
		for (var j = 0; j < imagesArr.length; j++) {
			imageElements.push(
				<BookedImages indexj={j} index={i} key={j} imagesArr={imagesArr}/>
			)
		}
		return (
			<div>
				<div id="booked">
		        	{imageElements}    
				</div>
	        	<button onClick={this.unBook}>Back</button>
	        </div>
        )
	},
	unBook: function () {
		var i = this.props.index;
		choices[i].booked = false;
		$.post('/choices/' + choices[i].id, {
  				booked: choices[i].booked})
		renderApp();
	}
})

var BookedImages = React.createClass({
	render: function () {
		var i = this.props.index;
		var j = this.props.indexj;
		var imagesArr = this.props.imagesArr;
		return (
			<img src={imagesArr[j]}/> 
		)
	}
})

var VoteSection = React.createClass({
	getInitialState: function () {
		return {
			hasVoted: false
		}
	},
	render: function () {
		var i = this.props.index;
		if (this.state.hasVoted === true) {
			var heartFill = <span className="heart"><img onClick={this.removeVote} src="images/heart-filled_thick.png"/><h3>{choices[i].likes}</h3></span>
		} else {
			heartFill = <span className="heart"><img onClick={this.addVote} src="images/heart-outline_thick.png"/><h3>{choices[i].likes}</h3></span>
		}
		return (
			heartFill
		)
	},
	addVote: function () {
		var i = this.props.index;
		if (this.state.hasVoted === false) {
			this.setState({hasVoted: true})
			choices[i].likes += 1;
			renderApp()	
		}
	},
	removeVote: function () {
		var i = this.props.index;
		if (this.state.hasVoted === true) {
			this.setState({hasVoted: false})
			choices[i].likes -= 1;
			renderApp()	
		}
	}
})

var AttendeesSection = React.createClass({
	render: function () {
		var attendeesElements = [];
		for (var i = 0; i < attendees.length; i++) {
			attendeesElements.push(
				<AttendeesRow index={i} key={i}/>
        	)
		}
		return (
			<div id="attendees-section">
				<h2>Attendees:</h2>
				<table>
					<tbody>
			            <tr>
			            	<th>Name</th>
			                <th>Status</th> 
			                <th>Notes</th>
			            </tr>
						{attendeesElements}
						<tr>
							<td><input type="text" ref="nameInput" placeholder="Add a name" onKeyDown={this.enterSubmitName}></input></td>
							<td></td>
							<td></td>
						</tr>
					</tbody>
	            </table>
	            <button onClick={this.addAttendees}>Add</button>
          	</div>
		)
	},

	addAttendees: function () {
		var nameInput = this.refs.nameInput;
		var nameText = nameInput.value;
		attendees.push(
			{
				name: nameText,
				status: "unpaid",
				notes: "+"
			}
		)
		nameInput.value = "";
		renderApp();
	},
	enterSubmitName: function (event) {
		if (event.keyCode === 13) {
			this.addAttendees();
		}
	}
});

var AttendeesRow = React.createClass({
	getInitialState: function () {
		return {
			isEditingName: false,
			isEditingNotes: false
		}
	},
	render: function () {
		var i = this.props.index;
		if (this.state.isEditingName === true) {
			var nameElement = <input type="text" ref="nameInput" defaultValue={attendees[i].name}></input>
		} else {
			nameElement = attendees[i].name;
		}
		if (this.state.isEditingNotes === true) {
			var notesElement = <input type="text" ref="notesInput" defaultValue={attendees[i].notes}></input>
		} else {
			notesElement = attendees[i].notes;
		}
		return (
			<tr>
				<td onClick={this.toggleEditOnName} onBlur={this.toggleEditOffName} onKeyDown={this.enterSubmitName}>{nameElement}</td>
				<td onClick={this.togglePaid}>{attendees[i].status}</td> 
				<td onClick={this.toggleEditOnNotes} onBlur={this.toggleEditOffNotes} onKeyDown={this.enterSubmitNotes}>{notesElement}</td>
			</tr>
		)
	},
	togglePaid: function () {
		var i = this.props.index;
		if (attendees[i].status === "unpaid") {
			attendees[i].status = "paid";
		} else {
			attendees[i].status = "unpaid";
		}
		renderApp();
	},
	toggleEditOnName: function () {
		if (!this.state.isEditingName) {
			this.setState({isEditingName: true})
		}
	},
	toggleEditOnNotes: function () {
		if (!this.state.isEditingNotes) {
			this.setState({isEditingNotes: true})
		}
	},
	toggleEditOffName: function () {
		var i = this.props.index;
		if (this.state.isEditingName) {
			this.setState({isEditingName: false})
			var nameInput = this.refs.nameInput;
			var nameText = nameInput.value;
			attendees[i].name = nameText;
		}
	},
	toggleEditOffNotes: function () {
		var i = this.props.index;
		if (this.state.isEditingNotes) {
			this.setState({isEditingNotes: false})
			var notesInput = this.refs.notesInput;
			var notesText = notesInput.value;
			attendees[i].notes = notesText;
		}
	},
	enterSubmitName: function (event) {
		if (event.keyCode === 13) {
			this.toggleEditOffName();
		}
	},
	enterSubmitNotes: function (event) {
		if (event.keyCode === 13) {
			this.toggleEditOffNotes();
		}
	}
})

var PackingSection = React.createClass({
	render: function () {
		var packingElements = [];
		for (var i = 0; i < packing.length; i++) {
			packingElements.push(
				<PackingRow index={i} key={i}/>
        	)
		}
		return (
			<div id="packing-section">
				<h2>Packing:</h2>
				<table>
					<tbody>
			            <tr>
			            	<th>Things to Bring</th>
			                <th>Who's Bringing It</th> 
			                <th>Notes</th>
			            </tr>
						{packingElements}
						<tr>
							<td><input type="text" ref="thingsInput" placeholder="Add a thing" onKeyUp={this.enterSubmitThings}></input></td>
							<td></td>
							<td></td>
						</tr>
					</tbody>
	            </table>
	            <button onClick={this.addToPacking}>Add</button>
          	</div>
		)
	},
	addToPacking: function () {
		var thingsInput = this.refs.thingsInput;
		var thingsText = thingsInput.value;
		packing.push(
			{
				thingsToBring: thingsText,
				whosBringingIt: "+",
				notes: "+"
			}
		)
		thingsInput.value = "";
		renderApp();
	},
	enterSubmitThings: function (event) {
		if (event.keyCode === 13) {
			this.addToPacking();
		}
	}
});

var PackingRow = React.createClass({
	getInitialState: function () {
		return {
			isEditingThingsToBring: false,
			isEditingWhosBringingIt: false,
			isEditingNotes: false
		}
	},
	render: function () {
		var i = this.props.index;
		if (this.state.isEditingThingsToBring === true) {
			var thingsElement = <input type="text" ref="thingsInput" defaultValue={packing[i].thingsToBring}></input>
		} else {
			thingsElement = packing[i].thingsToBring;
		}
		if (this.state.isEditingWhosBringingIt === true) {
			var whoElement = <input type="text" ref="whoInput" defaultValue={packing[i].whosBringingIt}></input>
		} else {
			whoElement = packing[i].whosBringingIt;
		}
		if (this.state.isEditingNotes === true) {
			var notesElement = <input type="text" ref="notesInput" defaultValue={packing[i].notes}></input>
		} else {
			notesElement = packing[i].notes;
		}
		return (
			<tr>
				<td onClick={this.toggleEditOnThings} onBlur={this.toggleEditOffThings} onKeyDown={this.enterSubmitThings}>{thingsElement}</td>
				<td onClick={this.toggleEditOnWho} onBlur={this.toggleEditOffWho} onKeyDown={this.enterSubmitWho}>{whoElement}</td> 
				<td onClick={this.toggleEditOnNotes} onBlur={this.toggleEditOffNotes} onKeyDown={this.enterSubmitNotes}>{notesElement}</td>
			</tr>
		)
	},
	toggleEditOnThings: function () {
		if (!this.state.isEditingThingsToBring) {
			this.setState({isEditingThingsToBring: true})
		}
	},
	toggleEditOnWho: function () {
		if (!this.state.isEditingWhosBringingIt) {
			this.setState({isEditingWhosBringingIt: true})
		}
	},
	toggleEditOnNotes: function () {
		if (!this.state.isEditingNotes) {
			this.setState({isEditingNotes: true})
		}
	},
	toggleEditOffThings: function () {
		var i = this.props.index;
		if (this.state.isEditingThingsToBring) {
			this.setState({isEditingThingsToBring: false})
			var thingsInput = this.refs.thingsInput;
			var thingsText = thingsInput.value;
			packing[i].thingsToBring = thingsText;
		}
	},
	toggleEditOffWho: function () {
		var i = this.props.index;
		if (this.state.isEditingWhosBringingIt) {
			this.setState({isEditingWhosBringingIt: false})
			var whoInput = this.refs.whoInput;
			var whoText = whoInput.value;
			packing[i].whosBringingIt = whoText;
		}
	},
	toggleEditOffNotes: function () {
		var i = this.props.index;
		if (this.state.isEditingNotes) {
			this.setState({isEditingNotes: false})
			var notesInput = this.refs.notesInput;
			var notesText = notesInput.value;
			packing[i].notes = notesText;
		}
	},
	enterSubmitThings: function (event) {
		if (event.keyCode === 13) {
			this.toggleEditOffThings();
		}
	},
	enterSubmitWho: function (event) {
		if (event.keyCode === 13) {
			this.toggleEditOffWho();
		}
	},
	enterSubmitNotes: function (event) {
		if (event.keyCode === 13) {
			this.toggleEditOffNotes();
		}
	}
});

var Details = React.createClass({
	getInitialState: function () {
		return {
			isEditing: false
		}
	},
	render: function () {
		if (this.state.isEditing === true) {
			var view =
				<div id="details-section">
					<h2>Details:</h2>
					<textarea defaultValue={details} type="text" ref="detailsInput"></textarea>
					<button onClick={this.handleClick}>Submit</button>
				</div>
		} else {	
			view = 
				<div id="details-section">
					<h2>Details:</h2>
					<p>{details}</p>
					<button onClick={this.toggleEditOn}>Edit</button>
				</div>
		}
		return (
			view
		)
	},
	saveDetails: function () {
		var detailsInput = this.refs.detailsInput;
		var detailsText = detailsInput.value;
		details = detailsText;
		console.log(details)
		renderApp();
	},
	toggleEditOn: function () {
		if (!this.state.isEditing) {
			this.setState({isEditing: true})
		}
	},
	toggleEditOff: function () {
		if (this.state.isEditing) {
			this.setState({isEditing: false})
		}
	},
	handleClick: function () {
		this.saveDetails();
		this.toggleEditOff();
	}
})

var App = React.createClass({
	render: function () {
		return (
			<div id="main">
				<div id="location-section">
					<TitleSection />
					{this.findBooked()}
					<AttendeesSection />
					<PackingSection />
					<Details />
				</div>
			</div>
		)
	},
	findBooked: function () {
		for (var i = 0; i < choices.length; i++) {
			if (choices[i].booked === true) {
				return <Booked index={i}/>
			}
		}
		return <VacationChoices />
	}
});

window.renderApp = function() {
  ReactDOM.render(<App />, document.getElementById("container"));
}

//function to find window.location
console.log(window.location.pathname + '/trip')

$.getJSON(window.location.pathname + '/trip', function (data) {
	window.title = data.trip.title
	window.choices = data.choices;
	window.images = data.choices.images;
	window.attendees = data.attendees;
	window.packing = data.packing;
	window.details = data.trip.details;
	renderApp();
})








